## 1. 몬테카를로 시뮬레이션의 의미

원주율을 구하는 과정부터 해석해보자. 우리가 ‘이론적으로’ 아는 원주율은 π이고, -1≤x,y≤1의 좌표계에서 직사각형의 넓이는 4이다. 주어진 좌표계에서 그려지는 원의 넓이는 π이므로, 임의의 점이 원 안에 들어올 확률은 π/4로 구해진다. 처음에 강조했듯, 이는 ‘이론적인 π를 대입했을 때의 확률’이다. 이론적으로 π는 3.141592…의 무한소수이다. 이 값을 실제로 구해볼 수는 없을까? 몬테카를로 시뮬레이션을 돌리면 가능하다. 그 논리는 다음과 같다. 


‘실제로’ 임의의 점을 생성했을 때, 그 중에 원의 방정식 안에 들어오는 점의 개수를 구하면 그것은 ‘실제로 구해지는 임의의 점이 원 안에 들어올 확률’이다. 이 값은 앞서 구한 π/4와 같아지므로, 이를 이용해 우리는 원주율을 실제로 구해볼 수 있다.


예제에서는 10000개를 돌려봤는데, 더 많이 돌릴수록 정확해지는지 궁금해서 20000개, 30000개를 각각 돌려보았다. VBA 코드를 활용해 수고로움을 줄일 수 있었다. 계산결과 20000개는 3.1442, 30000개는 3.143733으로 더 근사(similar)한 결과가 도출되었다.


몬테카를로 시뮬레이션은 답이 정해지지 않은 문제에 대해 확률적으로 의사결정을 할 수 있는 tool을 제공해준다는 점에서 그 의의가 있다. 예제는 의사결정과는 거리가 있긴 하지만, ‘확률적으로 답을 구해낸다’라는 점에서는 일맥상통한다. 난수를 어떻게 추출할 것인지가 몬테카를로 시뮬레이션의 핵심이다. 몬테카를로 시뮬레이션은 학계, 산업계 두루 전반적으로 꽤 활용도가 높은 기법이다. 


지금부터 우리는 몬테카를로 시뮬레이션을 활용해 주가를 예측해 볼 것이다. 기하 브라운 모형을 활용할 것이며, 난수는 표준정규분포를 따른다고 가정한다.

## 2. 몬테카를로 시뮬레이션을 활용한 주가 예측

먼저 어떤 모형을 활용할 것인지 결정해야 한다. 해당 예제에서는 기하 브라운 모형을 활용했다. 공식은 다음과 같다.

![image](https://user-images.githubusercontent.com/88834958/134807326-06cd0016-f0e3-463c-9838-d76bb49d38cc.png)
 
공식의 의의는 수익률의 평균과 표준편차(변동성)만 있으면 난수에 따라 주가를 구해낼 수 있다는 것이다. 블랙-숄즈 모형의 일부이기도 하다.

(https://terms.naver.com/entry.naver?docId=5669366&cid=60207&categoryId=60207)

수익률을 구할 때 로그수익률을 활용했는데, 로그수익률은 0을 기준으로 수익률이 대칭인 장점이 있으며 수익률 간의 단순 합산이 가능하여 금융 업계에서 널리 활용된다.

(https://insightcampus.co.kr/2019/01/04/%ED%8E%98%EC%96%B4-%ED%8A%B8%EB%A0%88%EC%9D%B4%EB%94%A9-%EA%B8%B0%EC%B4%88%ED%8E%B8-6-%EB%A1%9C%EA%B7%B8-%EC%88%98%EC%9D%B5%EB%A5%A0/)

로그수익률은 시점의 관점과 공간의 관점에서 해석할 수 있다. 시점의 관점에서는 어떤 과정을 지나오던 결국 매도-매수 시점의 수익률 차이가 결국 최종 수익률이 된다는 것이며, 공간의 관점에서는 두 종목의 Pair-Trading의 관점에서 해석할 수 있다.

이후 난수를 생성할 때 NORM.S.INV(RAND())함수를 활용했다. NORM.S.INV는 표준정규누적분포의 역함수라고 엑셀에서 설명하고 있다. 누적분포함수란 어떤 확률분포에 대해 확률변수가 특정 값보다 작거나 같을 확률을 나타내는 것이다. 그러므로 표준정규누적분포는 표준정규분포의 누적분포함수이다. 엑셀의 RAND()는 0부터 1사이의 값을 돌려준다. 그러므로 저 역함수에 RAND()값을 집어넣으면 그에 해당하는 ‘표준정규분포를 따르는 값’을 돌려줄 것이다. 우리가 원하는 값이다.
(적절한 테크닉이라고 생각하는 게, 누적분포는 1대1 대응일 수밖에 없으므로 표준정규분포를 따르는 ‘단 하나의 값’을 return해 줄 것이다.)

(https://ratsgo.github.io/statistics/2017/06/27/normal/)

이렇게 하면 1회 시뮬레이션에 대한 주가 예측을 진행할 수 있다. 이제 VBA 코드를 활용해서 100회 시뮬레이션을 돌려보자.


## 3. 엑셀 VBA 코드 해석

Redim 구문 : 배열변수 선언

Redim 수익률(1 to 10) as variant 라고 하면, 수익률 변수 안에 수익률(1)~수익률(10)까지 존재한다.

나머지는 VBA 코드 주석에 해석을 달아놓았다.
